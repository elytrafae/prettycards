// ==UserScript==
// @name        PrettyCards Audio
// @version     1.1.3
// @author      elytrafae
// @description Add vibrant sounds to an Undercards match!
// @homepage    https://github.com/elytrafae/prettycards
// @supportURL  https://github.com/elytrafae/prettycards
// @match       https://*.undercards.net/*
// @exclude     https://*.undercards.net/*/*
// @grant       none
// ==/UserScript==

!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";if(n.r(t),void 0===window.underscript){if(!window.localStorage.getItem("PrettyCardsAudio_DependencyErrorMessageShown")||"false"==window.localStorage.getItem("PrettyCardsAudio_DependencyErrorMessageShown")){window.BootstrapDialog.show({title:"Oh no!",type:window.BootstrapDialog.TYPE_WARNING,message:"Looks like you don't have Underscript installed, or you deactivated it! In order for PrettyCards Audio to work, you need to have it up and running. Until then, the features of this userscript will simply not work. Thank you for your understanding.",buttons:[{label:"Proceed",cssClass:"btn-primary",action:function(e){e.close()}}]});window.localStorage.setItem("PrettyCardsAudio_DependencyErrorMessageShown",!0)}}else window.localStorage.setItem("PrettyCardsAudio_DependencyErrorMessageShown",!1);var o=window.underscript.plugin("PrettyCards Audio");window.PrettyCardsAudio_plugin=o;var r={};r.turn_start=o.settings().add({key:"turn_start",name:"Turn Start volume",type:"slider",refresh:!1,default:50,reset:!0}),r.buff=o.settings().add({key:"buff",name:"Buff volume",type:"slider",refresh:!1,default:50,reset:!0}),r.nerf=o.settings().add({key:"nerf",name:"Nerf/Debuff volume",type:"slider",refresh:!1,default:50,reset:!0}),r.paralyze=o.settings().add({key:"paralyze",name:"Paralyze volume",type:"slider",refresh:!1,default:50,reset:!0}),r.kr=o.settings().add({key:"kr",name:"KR volume",type:"slider",refresh:!1,default:50,reset:!0}),r.silence=o.settings().add({key:"silence",name:"Silence volume",type:"slider",refresh:!1,default:50,reset:!0}),r.crit_spell_anim=o.settings().add({key:"crit_spell_anim",name:'Enable the "Critical Spell" animation.',type:"boolean",refresh:!1,default:!0}),r.crit_spell=o.settings().add({key:"crit_spell",name:"Critical Spell volume",note:'By a "Critical Spell", I mean a spell or monster effect that deals 7 or more damage, similar to how attacks have this, too. Unfortunately, this doesn\'t work properly 100% of the time because the server refuses to tell me what dealt the damage and so I have to do some magic guessing.',type:"slider",refresh:!1,default:50});var a=new class{constructor(){this.sounds={},this.audio_objects={}}SetSounds(){this.sounds={your_turn_start:this.GetSoundPath("Turn_Start"),enemy_turn_start:"",card_draw:"",monster_buff:this.GetSoundPath("Buff"),monster_nerf:this.GetSoundPath("Nerf"),paralyze:this.GetSoundPath("Paralyze"),kr:this.GetSoundPath("KR"),silence:this.GetSoundPath("Silence"),crit_spell:this.GetSoundPath("Spell_Crit")}}PlaySoundEffect(e,t=50,n=.4){if(window.soundEnabled&&!(t<=0)){this.audio_objects[e]&&this.audio_objects[e].pause();var o=this.sounds[e],r=new Audio(o);r.volume=n*(t/100),r.play(),this.audio_objects[e]=r}}GetSoundPath(e){var t="https://raw.githubusercontent.com/MysteryHD/prettycards-assets/master/";return window.PrettyCards_settings&&(t=window.PrettyCards_settings.asset_directory.value()),`${t}/audio/sfx/${e}.ogg`}};function i(e){var t=window[e];window[e]=function(){t.apply(null,arguments),o.events.emit(e,Array.from(arguments))}}o.events.on("connect",()=>{a.SetSounds()}),console.log("PrettyCards Audio!");var s="";window.underscript.onPage("Game")&&(o.events.on("getTurnStart",(function(e){window.userId==e.idPlayer&&a.PlaySoundEffect("your_turn_start",r.turn_start.value(),1)})),i("attackBuffAnimation"),o.events.on("attackBuffAnimation",(function(e){a.PlaySoundEffect("monster_buff",r.buff.value())})),i("hpBuffAnimation"),o.events.on("hpBuffAnimation",(function(e){a.PlaySoundEffect("monster_buff",r.buff.value())})),i("attackDebuffAnimation"),o.events.on("attackDebuffAnimation",(function(e){a.PlaySoundEffect("monster_nerf",r.nerf.value())})),i("hpDebuffAnimation"),o.events.on("hpDebuffAnimation",(function(e){a.PlaySoundEffect("monster_nerf",r.nerf.value())})),i("freezeAnimation"),o.events.on("freezeAnimation",(function(e){a.PlaySoundEffect("paralyze",r.paralyze.value())})),i("poisonAnimation"),o.events.on("poisonAnimation",(function(e){a.PlaySoundEffect("kr",r.kr.value())})),i("silenceAnimation"),o.events.on("silenceAnimation",(function(e){a.PlaySoundEffect("silence",r.silence.value())})),o.events.on("getFight getFightPlayer",(function(e){s="ATTACK",e.attackMonster})),o.events.on("getDoingEffect",(function(e){s="CARD_EFFECT",e.monsterId||e.spellId})),o.events.on("getArtifactDoingEffect",(function(e){s="ARTIFACT_EFFECT",e.artifactId,e.playerId})),o.events.on("getSoulDoingEffect",(function(e){s="SOUL_EFFECT",e.playerId,e.playerId})),i("hpStatAnimation"),o.events.on("hpStatAnimation",(function(e){e[2]<=-7&&s.endsWith("_EFFECT")&&function(){if(r.crit_spell_anim.value()){var e=window.$(".mainContent");e.effect("shake",{direction:"up",times:1,distance:5},25),e.effect("shake",{direction:"right",times:1,distance:5},25),e.effect("shake",{direction:"up",times:1,distance:5},25),e.effect("shake",{direction:"right",times:1,distance:5},25),a.PlaySoundEffect("crit_spell",r.crit_spell.value())}}()})))}]);